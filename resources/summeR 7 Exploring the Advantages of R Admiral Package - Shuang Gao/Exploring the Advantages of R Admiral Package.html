<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Exploring the Advantages of R Admiral Package</title>
    <meta charset="utf-8" />
    <meta name="author" content="Shuang Gao" />
    <script src="admiral_files/header-attrs/header-attrs.js"></script>
    <link href="admiral_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="admiral_files/tile-view/tile-view.js"></script>
    <script src="admiral_files/clipboard/clipboard.min.js"></script>
    <link href="admiral_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="admiral_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="admiral_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="admiral_files/fabric/fabric.min.js"></script>
    <link href="admiral_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="admiral_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#E68080"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <script src="admiral_files/xaringanExtra-progressBar/progress-bar.js"></script>
    <link href="admiral_files/panelset/panelset.css" rel="stylesheet" />
    <script src="admiral_files/panelset/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Exploring the Advantages of R Admiral Package
]
.author[
### Shuang Gao
]
.institute[
### BeiGene
]

---












<style>.xe__progress-bar__container {
  top:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #0051BA;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>


## Agenda

- The three **W's** of admiral
  - **What** is admiral
  - **Where** is the package located
  - **Why** use admiral
  
- Design of admiral

- How to use admiral

- Summary

---


## What is admiral
- An **open-source** toolbox which enables the development of ADaM datasets in R.
- **Modularised functions**, each with a standalone purpose.
- Designed for **code readability**, ease of understanding and flexibility
- Developed in the **collaboration** between following companies:

&lt;img src="img/admiralsystem.png" width="600" height="300" style="margin-left:200px;"&gt;
 
---

## Where is the package located


.pull-left[

&lt;img src="img/admiral-homepage.png" width="600" height="350" &gt;


]

.pull-right[

- Find **installation** guidance on the Admiral website homepage.
- See **user guides** for creating ADaMs with Admiral.
- Also look at our therapeutic area extension packages **Admiralonco, Admiraloptha and Admiralvaccine**.


.footnote[
<svg aria-label="Plug Circle Check" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Plug Circle Check</title><path d="M96 0C78.3 0 64 14.3 64 32v96h64V32c0-17.7-14.3-32-32-32zM288 0c-17.7 0-32 14.3-32 32v96h64V32c0-17.7-14.3-32-32-32zM32 160c-17.7 0-32 14.3-32 32s14.3 32 32 32v32c0 77.4 55 142 128 156.8V480c0 17.7 14.3 32 32 32s32-14.3 32-32V412.8c12.3-2.5 24.1-6.4 35.1-11.5c-2.1-10.8-3.1-21.9-3.1-33.3c0-80.3 53.8-148 127.3-169.2c.5-2.2 .7-4.5 .7-6.8c0-17.7-14.3-32-32-32H32zM576 368a144 144 0 1 0 -288 0 144 144 0 1 0 288 0zm-76.7-43.3c6.2 6.2 6.2 16.4 0 22.6l-72 72c-6.2 6.2-16.4 6.2-22.6 0l-40-40c-6.2-6.2-6.2-16.4 0-22.6s16.4-6.2 22.6 0L416 385.4l60.7-60.7c6.2-6.2 16.4-6.2 22.6 0z"/></svg> Find out more: [Admiral website](https://pharmaverse.github.io/admiral/cran-release/)
<svg aria-label="GitHub" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>GitHub</title><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> Feedback: [Admiral GitHub](https://github.com/pharmaverse/admiral)
 ]
]

---

## Why use admiral

.pull-left[

#### <svg aria-label="Triangle Exclamation" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><title>Triangle Exclamation</title><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg> Challenge

<svg aria-label="Viacoin" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Viacoin</title><path d="M384 32h-64l-80.7 192h-94.5L64 32H0l48 112H0v48h68.5l13.8 32H0v48h102.8L192 480l89.2-208H384v-48h-82.3l13.8-32H384v-48h-48l48-112zM192 336l-27-64h54l-27 64z"/></svg> No **standard solutions** for ADaMs
<svg aria-label="Flag" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Flag</title><path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"/></svg> A changing and **novel data landscape**
<svg aria-label="Gifts" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Gifts</title><path d="M200.6 32C205 19.5 198.5 5.8 186 1.4S159.8 3.5 155.4 16L144.7 46.2l-9.9-29.8C130.6 3.8 117-3 104.4 1.2S85 19 89.2 31.6l8.3 25-27.4-20c-10.7-7.8-25.7-5.4-33.5 5.3s-5.4 25.7 5.3 33.5L70.2 96H48C21.5 96 0 117.5 0 144V464c0 26.5 21.5 48 48 48H200.6c-5.4-9.4-8.6-20.3-8.6-32V256c0-29.9 20.5-55 48.2-62c1.8-31 17.1-58.2 40.1-76.1C271.7 104.7 256.9 96 240 96H217.8l28.3-20.6c10.7-7.8 13.1-22.8 5.3-33.5s-22.8-13.1-33.5-5.3L192.5 55.1 200.6 32zM363.5 185.5L393.1 224H344c-13.3 0-24-10.7-24-24c0-13.1 10.8-24 24.2-24c7.6 0 14.7 3.5 19.3 9.5zM272 200c0 8.4 1.4 16.5 4.1 24H272c-26.5 0-48 21.5-48 48v80H416V256h32v96H640V272c0-26.5-21.5-48-48-48h-4.1c2.7-7.5 4.1-15.6 4.1-24c0-39.9-32.5-72-72.2-72c-22.4 0-43.6 10.4-57.3 28.2L432 195.8l-30.5-39.6c-13.7-17.8-35-28.2-57.3-28.2c-39.7 0-72.2 32.1-72.2 72zM224 464c0 26.5 21.5 48 48 48H416V384H224v80zm224 48H592c26.5 0 48-21.5 48-48V384H448V512zm96-312c0 13.3-10.7 24-24 24H470.9l29.6-38.5c4.6-5.9 11.7-9.5 19.3-9.5c13.4 0 24.2 10.9 24.2 24z"/></svg> New therapeutic areas and analysis concepts


]

.pull-right[

&lt;img src="img/asset.PNG" width="400" height="200" style="margin-right:150px;"&gt;

####  <svg aria-label="Tumblr" role="img" viewBox="0 0 320 512" style="height:1em;width:0.62em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Tumblr</title><path d="M309.8 480.3c-13.6 14.5-50 31.7-97.4 31.7-120.8 0-147-88.8-147-140.6v-144H17.9c-5.5 0-10-4.5-10-10v-68c0-7.2 4.5-13.6 11.3-16 62-21.8 81.5-76 84.3-117.1.8-11 6.5-16.3 16.1-16.3h70.9c5.5 0 10 4.5 10 10v115.2h83c5.5 0 10 4.4 10 9.9v81.7c0 5.5-4.5 10-10 10h-83.4V360c0 34.2 23.7 53.6 68 35.8 4.8-1.9 9-3.2 12.7-2.2 3.5.9 5.8 3.4 7.4 7.9l22 64.3c1.8 5 3.3 10.6-.4 14.5z"/></svg> **Modularized toolbox**

&gt;Modularized toolbox aims to create a toolset that is both flexible and powerful.


]

---

## Why use admiral

#### <svg aria-label="Gifts" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Gifts</title><path d="M200.6 32C205 19.5 198.5 5.8 186 1.4S159.8 3.5 155.4 16L144.7 46.2l-9.9-29.8C130.6 3.8 117-3 104.4 1.2S85 19 89.2 31.6l8.3 25-27.4-20c-10.7-7.8-25.7-5.4-33.5 5.3s-5.4 25.7 5.3 33.5L70.2 96H48C21.5 96 0 117.5 0 144V464c0 26.5 21.5 48 48 48H200.6c-5.4-9.4-8.6-20.3-8.6-32V256c0-29.9 20.5-55 48.2-62c1.8-31 17.1-58.2 40.1-76.1C271.7 104.7 256.9 96 240 96H217.8l28.3-20.6c10.7-7.8 13.1-22.8 5.3-33.5s-22.8-13.1-33.5-5.3L192.5 55.1 200.6 32zM363.5 185.5L393.1 224H344c-13.3 0-24-10.7-24-24c0-13.1 10.8-24 24.2-24c7.6 0 14.7 3.5 19.3 9.5zM272 200c0 8.4 1.4 16.5 4.1 24H272c-26.5 0-48 21.5-48 48v80H416V256h32v96H640V272c0-26.5-21.5-48-48-48h-4.1c2.7-7.5 4.1-15.6 4.1-24c0-39.9-32.5-72-72.2-72c-22.4 0-43.6 10.4-57.3 28.2L432 195.8l-30.5-39.6c-13.7-17.8-35-28.2-57.3-28.2c-39.7 0-72.2 32.1-72.2 72zM224 464c0 26.5 21.5 48 48 48H416V384H224v80zm224 48H592c26.5 0 48-21.5 48-48V384H448V512zm96-312c0 13.3-10.7 24-24 24H470.9l29.6-38.5c4.6-5.9 11.7-9.5 19.3-9.5c13.4 0 24.2 10.9 24.2 24z"/></svg> **Good program design is the ability to easily understand what the program does by reading the code, not just how it does it.**

.panelset.sideways[

.panel[.panel-name[*Clean Code*]


&lt;img src="img/goodvsbad.PNG" width="600" height="350"&gt;

]

.panel[.panel-name[*Concise*]

_"The code should be small so that we can easily understand the intent of the function by just reading it."_
&gt;"The first rule of functions is that they should be small. The second rule of functions is that they should be smaller than that." — Robert C. Martin, Clean Code: A Handbook of Agile Software Craftsmanshi

]


.panel[.panel-name[*Single Responsibility*]

_"Functions should do one thing. They should do it well. They should do it only."_
&gt; Functions should have a single responsibility and not be overly complex. Breaking down tasks into smaller, single-purpose functions improves maintainability.


]

]


---
### Design of admiral - Ways to Think About Data


.panelset[
.panel[.panel-name[Conceptual Diagram]

&lt;img src="img/Ways1.PNG" width="650" height="360" style="margin-left:150px;"&gt;

]

.panel[.panel-name[Analysts]
&lt;img src="img/Ways2.PNG" width="650" height="360" style="margin-left:150px;"&gt;
]

.panel[.panel-name[Programming languages]
&lt;img src="img/Ways3.PNG" width="650" height="360" style="margin-left:150px;"&gt;
]

]


---
### Design of admiral - Data Manipulation

&lt;img src="img/dplyr.svg" width="800" height="450" style="margin-left:150px;"&gt;



---
### Design of admiral - Data Manipulation

&lt;img src="img/join.svg" width="800" height="450" style="margin-left:100px;"&gt;



---
### Design of admiral -  Derive Family

&gt; Use Intention-Revealing Names: "The name of a variable, function, or class, should answer all the big questions. It should tell you why it exists, what it does, and how it is used."

&lt;img src="img/R-Derive.png" width="500" height="300" style="margin-left:300px;"&gt;


---
### Design of admiral - Derive Family

.pull-left[
&lt;img src="img/R-Date_timming.png" width="500" height="400" style="margin-right:150px;"&gt;
]


.pull-right[


.panelset[
.panel[.panel-name[Usage]



```r
derive_vars_dt(
  dataset,
  new_vars_prefix,
  dtc,
  highest_imputation = "n",
  date_imputation = "first",
  flag_imputation = "auto",
  min_dates = NULL,
  max_dates = NULL,
  preserve = FALSE
)
```



]

.panel[.panel-name[Input]



```r
library(tibble)
library(lubridate)

mhdt &lt;- tribble(
  ~MHSTDTC,
  "2019-07-18T15:25:40",
  "2019-07-18T15:25",
  "2019-07-18",
  "2019-02",
  "2019",
  "2019---07",
  ""
)
```

]

.panel[.panel-name[R Code]



```r
# Create ASTDT and ASTDTF
# No imputation for partial date
derive_vars_dt(
  mhdt,
  new_vars_prefix = "AST",
  dtc = MHSTDTC
)
```

]

.panel[.panel-name[Output]



```r
#&gt; # A tibble: 7 × 2
#&gt;   MHSTDTC               ASTDT     
#&gt;   &lt;chr&gt;                 &lt;date&gt;    
#&gt; 1 "2019-07-18T15:25:40" 2019-07-18
#&gt; 2 "2019-07-18T15:25"    2019-07-18
#&gt; 3 "2019-07-18"          2019-07-18
#&gt; 4 "2019-02"             NA        
#&gt; 5 "2019"                NA        
#&gt; 6 "2019---07"           NA        
#&gt; 7 ""                    NA   
```


]

]


]





---
### Design of admiral - Derive Family

.pull-left[
&lt;img src="img/R-ADSL.png" width="500" height="400" style="margin-right:150px;"&gt;
]




.pull-right[


.panelset[
.panel[.panel-name[Usage]



```r
derive_vars_duration(
  dataset,
  new_var,
  new_var_unit = NULL,
  start_date,
  end_date,
  in_unit = "days",
  out_unit = "days",
  floor_in = TRUE,
  add_one = TRUE,
  trunc_out = FALSE
)
```



]




.panel[.panel-name[R code]



```r
library(lubridate)
library(tibble)


data &lt;- tribble(
  ~USUBJID, ~ASTDT, ~AENDT,
  "P01", ymd("2021-03-05"), ymd("2021-03-02"),
  "P02", ymd("2019-09-18"), ymd("2019-09-18"),
  "P03", ymd("1985-01-01"), NA,
  "P04", NA, NA
)

derive_vars_duration(data,
  new_var = ADURN,
  new_var_unit = ADURU,
  start_date = ASTDT,
  end_date = AENDT,
  out_unit = "days"
)
```


]

.panel[.panel-name[Output]



```r
#&gt; # A tibble: 4 × 5
#&gt;   USUBJID ASTDT      AENDT      ADURN ADURU
#&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;
#&gt; 1 P01     2021-03-05 2021-03-02    -3 DAYS 
#&gt; 2 P02     2019-09-18 2019-09-18     1 DAYS 
#&gt; 3 P03     1985-01-01 NA            NA NA   
#&gt; 4 P04     NA         NA            NA NA 
```


]

]


]


---
### Design of admiral - Derive Family

.pull-left[
&lt;img src="img/R-BDS.png" width="500" height="400" style="margin-right:150px;"&gt;
]




.pull-right[


.panelset[
.panel[.panel-name[Usage]



```r
derive_param_bsa(
  dataset,
  by_vars,
  method,
  set_values_to = exprs(PARAMCD = "BSA"),
  height_code = "HEIGHT",
  weight_code = "WEIGHT",
  get_unit_expr,
  filter = NULL
)
```



]




.panel[.panel-name[Input]




```r
library(tibble)

advs &lt;- tribble(
  ~USUBJID, ~PARAMCD, ~PARAM, ~AVAL, ~VISIT,
  "01-701-1015", "HEIGHT", "Height (cm)", 170, "BASELINE",
  "01-701-1015", "WEIGHT", "Weight (kg)", 75, "BASELINE",
  "01-701-1015", "WEIGHT", "Weight (kg)", 78, "MONTH 1",
  "01-701-1015", "WEIGHT", "Weight (kg)", 80, "MONTH 2",
  "01-701-1028", "HEIGHT", "Height (cm)", 185, "BASELINE",
  "01-701-1028", "WEIGHT", "Weight (kg)", 90, "BASELINE",
  "01-701-1028", "WEIGHT", "Weight (kg)", 88, "MONTH 1",
  "01-701-1028", "WEIGHT", "Weight (kg)", 85, "MONTH 2",
)
```



]

.panel[.panel-name[R code]



```r
derive_param_bsa(
  advs,
  by_vars = exprs(USUBJID, VISIT),
  method = "Mosteller",
  set_values_to = exprs(
    PARAMCD = "BSA",
    PARAM = "Body Surface Area (m^2)"
  ),
  get_unit_expr = extract_unit(PARAM)
)
```

]


.panel[.panel-name[Output]



```r
#&gt; # A tibble: 10 × 5
#&gt;    USUBJID     PARAMCD PARAM                     AVAL VISIT   
#&gt;    &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;                    &lt;dbl&gt; &lt;chr&gt;   
#&gt;  1 01-701-1015 HEIGHT  Height (cm)             170    BASELINE
#&gt;  2 01-701-1015 WEIGHT  Weight (kg)              75    BASELINE
#&gt;  3 01-701-1015 WEIGHT  Weight (kg)              78    MONTH 1 
#&gt;  4 01-701-1015 WEIGHT  Weight (kg)              80    MONTH 2 
#&gt;  5 01-701-1028 HEIGHT  Height (cm)             185    BASELINE
#&gt;  6 01-701-1028 WEIGHT  Weight (kg)              90    BASELINE
#&gt;  7 01-701-1028 WEIGHT  Weight (kg)              88    MONTH 1 
#&gt;  8 01-701-1028 WEIGHT  Weight (kg)              85    MONTH 2 
#&gt;  9 01-701-1015 BSA     Body Surface Area (m^2)   1.88 BASELINE
#&gt; 10 01-701-1028 BSA     Body Surface Area (m^2)   2.15 BASELINE
```

]

]

]

---
class: inverse center middle

# Data Manipulation of Multiple Dataframes


---


### Design of admiral - Data Manipulation

.pull-left[

.panelset[
.panel[.panel-name[Usage]


```r
derive_vars_merged(
  dataset,
  dataset_add,
  by_vars,
  order = NULL,
  new_vars = NULL,
  filter_add = NULL,
  mode = NULL,
  match_flag = NULL,
  missing_values = NULL,
  check_type = "warning",
  duplicate_msg = NULL
)
```
]

.panel[.panel-name[Input]


```r
library(dplyr, warn.conflicts = FALSE)
adsl &lt;- tribble(
  ~USUBJID, ~SEX, ~COUNTRY,
  "ST42-1", "F",  "AUT",
  "ST42-2", "M",  "MWI",
  "ST42-3", "M",  "NOR",
  "ST42-4", "F",  "UGA"
)

advs &lt;- tribble(
  ~USUBJID, ~PARAMCD, ~AVISIT,    ~AVISITN, ~AVAL,
  "ST42-1", "WEIGHT", "BASELINE",        0,    66,
  "ST42-1", "WEIGHT", "WEEK 2",          1,    68,
  "ST42-2", "WEIGHT", "BASELINE",        0,    88,
  "ST42-3", "WEIGHT", "WEEK 2",          1,    55,
  "ST42-3", "WEIGHT", "WEEK 4",          2,    50
)
```
]


.panel[.panel-name[R code]


```r
derive_vars_merged(
  adsl,
  dataset_add = advs,
  by_vars = exprs(USUBJID),
  new_vars = exprs(
    LSTVSCAT = if_else(AVISIT == "BASELINE", "BASELINE", "POST-BASELINE")
  ),
  order = exprs(AVISITN),
  mode = "last",
  missing_values = exprs(LSTVSCAT = "MISSING")
)
```
]


.panel[.panel-name[Output]


```r
#&gt; # A tibble: 4 × 4
#&gt;   USUBJID SEX   COUNTRY LSTVSCAT     
#&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;        
#&gt; 1 ST42-1  F     AUT     POST-BASELINE
#&gt; 2 ST42-2  M     MWI     BASELINE     
#&gt; 3 ST42-3  M     NOR     POST-BASELINE
#&gt; 4 ST42-4  F     UGA     MISSING 
```
]

]

]


.pull-right[
&lt;img src="img/R-merge.png" width="400" height="300" style="margin-right:10px;"&gt;

]



---



### Design of admiral - Data Manipulation

.pull-left[

.panelset[

.panel[.panel-name[Usage]


```r
derive_vars_joined(
  dataset,
  dataset_add,
  by_vars = NULL,
  order = NULL,
  new_vars = NULL,
  join_vars = NULL,
  filter_add = NULL,
  filter_join = NULL,
  mode = NULL,
  missing_values = NULL,
  check_type = "warning"
)
```
]


.panel[.panel-name[Input Data]


```r
adae &lt;- tribble(
  ~USUBJID, ~ASTDT,       ~AESEQ,
  "1",      "2020-02-02",      1,
  "1",      "2020-02-04",      2
) %&gt;%
  mutate(ASTDT = ymd(ASTDT))

ex &lt;- tribble(
  ~USUBJID, ~EXSDTC,
  "1",      "2020-01-10",
  "1",      "2020-01",
  "1",      "2020-01-20",
  "1",      "2020-02-03"
)
```
]

.panel[.panel-name[R code]



```r
derive_vars_joined(
  adae,
  dataset_add = ex,
  by_vars = exprs(USUBJID),
  order = exprs(EXSDT = convert_dtc_to_dt(EXSDTC)),
  new_vars = exprs(LDRELD = compute_duration(
    start_date = EXSDT, end_date = ASTDT
  )),
  filter_add = !is.na(EXSDT),
  filter_join = EXSDT &lt;= ASTDT,
  mode = "last"
)
```
]


.panel[.panel-name[Output]


```r
#&gt; # A tibble: 2 × 4
#&gt;   USUBJID ASTDT      AESEQ LDRELD
#&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 1       2020-02-02     1     14
#&gt; 2 1       2020-02-04     2      2
```
]

]

]

.pull-right[

&lt;img src="img/R-join.png"  &gt;

]




---

### Design of admiral 

.pull-left[
####  **Multiple Sources**

&lt;img src="img/R-multiple.png" width="400" height="300" style="margin-right:50px;"&gt;
]

.pull-right[
#### **Higher Order**

&lt;img src="img/R-higher.png" width="400" height="300" style="margin-right:50px;"&gt;

]



---
## How to use admiral

.pull-left[
&lt;img src="img/R-adsl_workflow.png" width="300" height="420" style="margin-left:100px;" &gt;
]

.pull-right[

.panelset[
.panel[.panel-name[Tab1]


```r
## Derive variables for first/last treatment date and time imputation flags
adsl &lt;- adsl %&gt;%
  derive_vars_merged(
    dataset_add = ex_ext,
    filter_add = !is.na(EXSTDTM),
    new_vars = exprs(TRTSDTM = EXSTDTM, TRTSTMF = EXSTTMF),
    order = exprs(EXSTDTM, EXSEQ),
    mode = "first",
    by_vars = exprs(STUDYID, USUBJID)
  ) 
```
]


.panel[.panel-name[Tab2]


```r
# convert character date to numeric date without imputation
ds_ext &lt;- derive_vars_dt(
  ds,
  dtc = DSSTDTC,
  new_vars_prefix = "DSST"
)

adsl &lt;- adsl %&gt;%
  derive_vars_merged(
    dataset_add = ds_ext,
    by_vars = exprs(STUDYID, USUBJID),
    new_vars = exprs(EOSDT = DSSTDT),
    filter_add = DSCAT == "DISPOSITION EVENT" &amp; DSDECOD != "SCREEN FAILURE"
  )
```
]

.panel[.panel-name[Tab3]


```r
src_ae &lt;- dthcaus_source(
  dataset_name = "ae",
  filter = AEOUT == "FATAL",
  date = convert_dtc_to_dtm(AESTDTC, highest_imputation = "M"),
  mode = "first",
  dthcaus = AEDECOD
)
```
]

.panel[.panel-name[Tab4]


```r
adsl &lt;- adsl %&gt;%
  derive_var_extreme_dt(
    new_var = LSTALVDT,
    ae_start_date, ae_end_date, lb_date, trt_end_date,
    source_datasets = list(ae = ae, adsl = adsl, lb = lb),
    mode = "last"
  )
```
]


.panel[.panel-name[Tab5]


```r
adsl &lt;- adsl %&gt;%
  derive_var_merged_exist_flag(
    dataset_add = ex,
    by_vars = exprs(STUDYID, USUBJID),
    new_var = SAFFL,
    condition = (EXDOSE &gt; 0 | (EXDOSE == 0 &amp; str_detect(EXTRT, "PLACEBO")))
  )
```
]

]


]


---
## Summary

- <svg aria-label="Triangle Exclamation" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Triangle Exclamation</title><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg> Admiral, as an **open-source project**, allows anyone to access the source code, learn, modify, and enhance it. This fosters transparency, education, and innovation, enabling different teams and individuals to collaborate in the effort to improve the tool.

- <svg aria-label="Code" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Code</title><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg>  Admiral package advocates the use of **simple, composable small functions** to build complex behaviors, which helps to improve the readability and maintainability of the code.

- <svg aria-label="Check" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#1381B0;overflow:visible;position:relative;"><title>Check</title><path d="M470.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L192 338.7 425.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg> This project provides an entry point for **collaboration, co-creation, and contribution for everyone** in the pharmaceutical industry. This collaborative effort helps in achieving standardized and consistent methods for developing ADaMs across the entire industry.

---
class: center, middle

## Acknowledgement

#### Qiao Yan




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-image: url(logo.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 140px;
  height: 148px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
